<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claim Page</title>
    <link rel="stylesheet" href="create_claim.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.6.4/flowbite.min.css" rel="stylesheet" />
    <link href="https://getbootstrap.com/docs/5.3/getting-started/introduction/" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.6.4/flowbite.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio,line-clamp"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>  
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              clifford: '#da373d',
            }
          }
        }
      }
    </script>
     <style type="text/tailwindcss">
      @layer utilities {
        .content-auto {
          content-visibility: auto;
        }
      }
    </style>
</head>
<body>
    <div class="bg-gray-50 min-h-screen text-sm text-gray-700">

  <div class="bg-white shadow-card w-full pt-8 pb-4 sm:pt-10 sm:pb-6 mb-2">
    <div class="max-w-4xl mx-auto px-4">
      <img src="https://uxwing.com/wp-content/themes/uxwing/download/file-and-folder-type/claim-icon.png" alt="HelloClaims" class="mb-4 sm:mb-6 h-10 sm:h-12">
      <h1 class="text-xl sm:text-2xl font-semibold">Claim Application</h1>
    </div>
  </div>

  <div class="max-w-4xl mx-auto">
    <section class="w-full border-b border-gray-200 px-4 py-6 flex flex-col md:flex-row">
      <div class="mb-4 mr-6 md:w-64">
        <h3 class="text-base font-semibold mb-1">Employee details</h3>
      </div>

      <div class="shadow-card bg-white sm:rounded -mx-4 sm:m-0 px-4 pt-5 pb-1 sm:px-5 flex flex-wrap justify-between md:w-full md:max-w-xl">

        <div class="field-group flex flex-col mb-4 w-full md:w-1/2">
          <label class="field-label mb-1" for="departmentId">Department</label>
          <input class="field md:mr-2 border  text-grey-700 rounded read-only:bg-gray-100" type="text" name="departmentId" id="departmentId" readonly>
        </div>
        <div class="field-group flex flex-col mb-4 w-full md:w-1/2">
          <label class="field-label mb-1 md:ml-2" for="employeeName">Name</label>
          <input class="field md:ml-2 border text-grey-700 rounded read-only:bg-gray-100" type="text" name="employeeName" id="employeeName" readonly>
        </div>
        <div class="field-group flex flex-col mb-4 w-1/2">
          <label class="field-label mb-1" for="email">Email</label>
          <input class="field mr-2 border text-grey-700 rounded read-only:bg-gray-100" type="text" name="email" id="email" readonly>
        </div>
        <div class="field-group flex flex-col mb-4 w-1/2">
          <label class="field-label mb-1 ml-2" for="last_name">Phone Number</label>
          <input class="field ml-2 border text-grey-700 rounded read-only:bg-gray-100" type="text" name="phoneNumber" id="phoneNumber" readonly>
        </div>
      </div>
    </section>
    
    
    <section class="w-full border-b border-gray-200 px-4 py-6 flex flex-col md:flex-row">
    
        <div class="mb-4 mr-6 md:w-64">
        <h3 class="text-base font-semibold">Claim Details</h3>
        <p class="text-grey-500">Please fill all required fields </p>

        <!--         <p class="text-grey-500">Secondary text could go here to help explain why we need this info</p> -->
        </div>
    <form action="/create_claim" method="POST" id="createClaim" enctype="multipart/form-data">
      <div class="shadow-card bg-white sm:rounded -mx-4 sm:m-0 px-4 pt-5 pb-1 sm:px-5 flex flex-wrap justify-between md:w-full md:max-w-xl">

        <div class="field-group flex flex-col mb-4 w-full">
          <label class="field-label mb-2 ml-2 required" for="catastrophe_event">Claim Type</label>
          <select name="type" id="type-select" class="field border ml-2 text-grey-700 rounded">
            <option disabled selected value>Please select the claim type....</option>
            <option value="Ct05">Advertising</option>
            <option value="ct04">Allowance</option>
            <option value="ct03">Business Meals</option>
            <option value="ct01">Continuing Education</option>
            <option value="Ct05">Medical</option>
            <option value="ct02">Office expenses</option>
            <option value="ct01">Transportation</option>
            <option value="ct01">Travel</option>
            <option value="Ct06">Other</option>
          </select>
        </div>

        <div class="field-group flex flex-col mb-4 w-full">
          <label class="field-label mb-2 ml-2 required" for="catastrophe_event">Claim Description</label>
          <input class="field ml-2 border text-grey-700 rounded" type="text" name="claim_description" id="claim_d">
        </div>
        <div class="field-group flex flex-col mb-4 w-1/2">
            <label class="field-label mb-1 ml-2 required" for="last_name">Transaction Date</label>
            <input class="field ml-2 border text-grey-700 rounded" type="date" name="t_date" id="t_date">
        </div>
        <div class="field-group flex flex-col mb-4 w-1/2">
            <label class="field-label mb-1 ml-2 required required:border-red-50" for="last_name">Amount</label>
            <input class="field ml-2 border text-grey-700 rounded" type="text" name="amount" id="amount" placeholder="0.00" >
        </div>
        <div class="field-group flex flex-col mb-4 w-full">
          <label class="field-label mb-2 ml-2 required" for="attachment">Upload File</label>         
          <input class="block w-full ml-2 text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 dark:text-gray-400 focus:outline-none dark:bg-white-700 dark:border-gray-600 dark:placeholder-gray-400" type="file" name="attachment" id="attachment" accept="image/*, .pdf,capture=camera" multiple>
        </div>
        <div class="field-group flex flex-row mb-4 ml-2 w-full preview">
        </div>
        <div class="field-group flex flex-col mb-4 w-full">
          <label class="field-label mb-2 ml-2" for="catastrophe_event" hidden>Claim Status</label>
          <input class="field ml-2 border text-grey-700 rounded read-only:bg-gray-100" value="Pending" type="hidden" name="claim_status" id="claim_status" readonly>
        </div>
   
    </div>
    </section>
    
    

    <section class="w-full border-b border-gray-200 px-4 py-6 flex flex-col md:flex-row">
    </section>

  </div>

</div>

<div class="bg-white w-full text-sm fixed bottom-0 left-0 border-t border-gray-200">
  <div class="max-w-4xl mx-auto px-4 flex flex-row justify-end pt-4 pb-5">
    <button class="btn">Close</button>
    <button class="btn btn-primary" type="submit">View Summary</button>
  </div>
</div>
</form>

<script>
  
  //load info from db into employee table
 window.addEventListener("load", async()=>{ 
    const res = await fetch ("/getEmployee", {
        method:"GET",
        headers:{"Content-Type": "application/json"},
      });
      const employeeList = await res.json()
      console.log(employeeList) //check the employee list
     const departmentId = document.querySelector("#departmentId");
     const employeeName = document.querySelector("#employeeName");
     const email = document.querySelector("#email");
     const phoneNumber = document.querySelector("#phoneNumber");
     departmentId.value=employeeList.department_id
     employeeName.value=employeeList.name
     email.value=employeeList.email
     phoneNumber.value=employeeList.phone_number

    }
  )






  let createClaim = document.querySelector("#createClaim");
  createClaim.addEventListener("submit", async function (event) {
    event.preventDefault();
    const attachment = event.target;
    const attachData = new FormData(attachment);

    const res = await fetch("/create_claim", {
      method: "POST",
      body: attachData,
    });
    const result = await res.json();
    console.log(result)
    //document.querySelector(".preview").textContent = console.log(result); show the sucess:true result
  });

  let attachInput = document.querySelector("#attachment");
  attachInput.addEventListener("change", preview);
  function preview(e) {
  let fileObject = this.files;
  if(fileObject.length>4){
    e.preventDefault();
    Swal.fire({
  icon: 'error',
  title: 'Error uploading files:',
  text: 'Maximum Upload 4 files',
})
e.target.value="";
  }else {
  for (let i = 0; i < fileObject.length; i++) {
    let fileReader = new FileReader();
    if(fileObject[i].type ==="image/jpeg" || "image/bmp" || "image/png"){
    fileReader.readAsDataURL(fileObject[i]);
    fileReader.onload = function () {
      let result = fileReader.result;
      let preview = document.createElement("img");
      preview.setAttribute("src", result);
      preview.setAttribute("class", "preview-image");
      preview.setAttribute("class", "mx-3");
      document.querySelector(".preview").appendChild(preview);
    };}}}}
</script>
</body>
</html>