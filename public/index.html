<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login Page</title>
    <link rel="stylesheet" , href="./css/login.css" />
  </head>
  <body>
    <div class="box">
      <form id="login" action="/login" method="POST">
        <div class="text-center">Login</div>
        <div class="input-container">
          <input id="loginInput" type="text" name="username" required />
          <label for="username">Email / User Name: </label>
        </div>
        <div class="input-container">
          <input id="passwordInput" type="password" name="password" required />
          <label for="password">Password:</label>
        </div>

        <button type="submit" class="btn">Login</button>
        <button id="forgotpw" class="btn" onclick="forgotpwRequest()">
          Forgot Password?
        </button>
        <div id="loginStatus"></div>
      </form>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
      let loginInput = document.querySelector("#loginInput");
      let passwordInput = document.querySelector("#passwordInput");
      let login = document.querySelector("#login");
      let forgotpw = document.querySelector("#forgotpw");

      login.addEventListener("submit", async function (event) {
        event.preventDefault();
        const loginForm = event.target;
        const loginObject = {};
        loginObject.username = loginForm.username.value;
        loginObject.password = loginForm.password.value;

        const res = await fetch("/login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(loginObject),
        });
        const result = await res.json();
        document.querySelector("#loginStatus").textContent = result.Error;
        if (result.role === "admin") {
          window.location.href = "/admin.html";
        } else if (result.role === "user") {
          window.location.href = "/user.html";
        }
      });

      async function forgotpwRequest() {
        const { value: email } = await Swal.fire({
          title: "Forgot Password?",
          text: "Please enter the email address you'd like your password reset information sent to",
          focusConfirm: false,
          showCloseButton: true,
          showCancelButton: true,
          confirmButtonText: "Request reset link",
          cancelButtonText: "Back To Login",
          popup: "swal2-show",
          backdrop: "swal2-backdrop-show",
          icon: "swal2-icon-show",
          input: "email",
          inputPlaceholder: "Your email address",
          showLoaderOnConfirm: true,
        });
        if (email) {
          Swal.fire(`Request link sent to ${email}`);
        }
      }
    </script>
  </body>
</html>
